<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>키위 오늘 상태</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 16px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin-bottom: 12px; }
    .k { color: #666; font-size: 14px; }
    .v { font-size: 22px; margin-top: 4px; }
    .row { display: flex; gap: 10px; }
    .row > div { flex: 1; }
    button { padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; background: #fff; }
    pre { white-space: pre-wrap; font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <h2>키위 오늘 상태</h2>

  <div class="card">
    <div class="k">마지막 업데이트(UTC)</div>
    <div class="v" id="updated">불러오는 중...</div>
    <button onclick="loadStatus()">새로고침</button>
  </div>

  <div class="card">
    <div class="k">온도(°C)</div>
    <div class="row">
      <div>
        <div class="k">외부</div>
        <div class="v" id="t_out">-</div>
      </div>
      <div>
        <div class="k">2동</div>
        <div class="v" id="t_2">-</div>
      </div>
      <div>
        <div class="k">3동</div>
        <div class="v" id="t_3">-</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="k">GDD(2/15부터)</div>
    <div class="v" id="gdd">-</div>
    <div class="k" id="pred">발아/만개 예측일: -</div>
  </div>

  <div class="card">
    <div class="k">칠링(11/1~2/14)</div>
    <div class="v" id="chill">-</div>
    <div class="k" id="chill_dates">후반/거의끝 날짜: -</div>
  </div>

  <div class="card">
    <div class="k">문제 생기면(원본)</div>
    <pre id="rawmini"></pre>
  </div>

<script>
async function loadStatus() {
  try {
    // cache: "no-store" 로 브라우저 캐시를 덜 타게 함 [web:190]
    const base = window.location.pathname.split('/').slice(0, 3).join('/'); 
// 결과 예: /사용자명.github.io/레포명  (Pages 기본 구조)
const res = await fetch(`${base}/data/status.json`, { cache: "no-store" });

    const s = await res.json();

    document.getElementById("updated").textContent = s.updated_utc ?? "-";

    const now = s.now ?? {};
    document.getElementById("t_out").textContent = (now["외부_c"] ?? "-");
    document.getElementById("t_2").textContent = (now["2동_c"] ?? "-");
    document.getElementById("t_3").textContent = (now["3동_c"] ?? "-");

    const g = s.gdd ?? {};
    document.getElementById("gdd").textContent = (g.cum_from_0215 ?? g["누적_gdd_0215"] ?? "-");
    const bud = (g.pred_bud10_date ?? g["발아10_예측일"] ?? "-");
    const bloom = (g.pred_bloom50_date ?? g["만개50_예측일"] ?? "-");
    document.getElementById("pred").textContent = `발아10%: ${bud} / 만개50%: ${bloom}`;

    const c = s.chill ?? {};
    const pct = (c.pct ?? c["진행률_pct"] ?? "-");
    const cum = (c.cum ?? c["누적"] ?? "-");
    document.getElementById("chill").textContent = `${cum}점 (${pct}%)`;
    const d70 = (c.date_70 ?? c["후반70_날짜"] ?? "-");
    const d90 = (c.date_90 ?? c["거의끝90_날짜"] ?? "-");
    document.getElementById("chill_dates").textContent = `후반(70%): ${d70} / 거의끝(90%): ${d90}`;

    // 문제 생겼을 때만 보기용(일부만)
    document.getElementById("rawmini").textContent = JSON.stringify({
      now: s.now, gdd: s.gdd, chill: s.chill
    }, null, 2);

  } catch (e) {
    document.getElementById("updated").textContent = "불러오기 실패(새로고침 해보세요)";
    document.getElementById("rawmini").textContent = String(e);
  }
}
loadStatus();
</script>
</body>
</html>
