<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>ì œì£¼ í‚¤ìœ„ ì ì‚°ì˜¨ë„ ëª¨ë‹ˆí„°ë§</title>
    <style>
        body { font-family: -apple-system, sans-serif; max-width: 400px; margin: 20px auto; padding: 20px; background: #f8f9fa; }
        .card { background: white; padding: 20px; border-radius: 12px; margin: 10px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .temp { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .gdd { background: linear-gradient(90deg, #e3f2fd 0%, #bbdefb var(--progress)); padding: 12px; border-radius: 8px; }
        .pred { color: #27ae60; font-weight: bold; }
        .progress { color: #3498db; }
        small { color: #7f8c8d; }
    </style>
</head>
<body>
    <h1>ğŸ¥ ì œì£¼ í‚¤ìœ„ ëª¨ë‹ˆí„°ë§</h1>

    <div class="card" id="now">
        <div>ì‹¤ì‹œê°„ ì˜¨ë„</div>
        <div class="temp" id="temp-out">-</div>
        <div>ì™¸ë¶€ / <span id="temp-2dong">-</span> (2ë™) / <span id="temp-3dong">-</span> (3ë™)</div>
    </div>

    <div class="card">
        <div>GDD ì§„í–‰ë„ <span class="progress" id="gdd-progress">-</span></div>
        <div class="gdd">
            <strong id="gdd-total">-</strong> / <span id="gdd-bud">-</span> (ë°œì•„10%)<br>
            <strong id="gdd-total2">-</strong> / <span id="gdd-bloom">-</span> (ë§Œê°œ50%)
        </div>
        <small id="gdd-basis">-</small>
    </div>

    <div class="card">
        <div>ì˜ˆìƒ ê°œí™”ì¼ <span class="progress" id="chill-progress">-</span></div>
        <div class="pred">ë°œì•„10%: <span id="bud-date">-</span></div>
        <div class="pred">ë§Œê°œ50%: <span id="bloom-date">-</span></div>
    </div>

    <div class="card">
        <div>ì¹ ë§ ëˆ„ì  <span id="chill-total">-</span> / 100ì¼</div>
    </div>

    <div style="text-align:center; padding:20px 0; color:#7f8c8d;">
        ìµœì¢… ì—…ë°ì´íŠ¸: <span id="timestamp">-</span><br>
        <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <script>
        const toNumber = (value) => {
            if (value === null || value === undefined || value === '') return null;
            const n = Number(value);
            return Number.isFinite(n) ? n : null;
        };

        const fmtTemp = (value) => {
            const n = toNumber(value);
            return n === null ? '-' : `${n.toFixed(1)}Â°C`;
        };

        const pick = (...values) => values.find(v => v !== undefined && v !== null && v !== '');

        fetch('data/status.json')
            .then((r) => r.json())
            .then((data) => {
                const now = data.now || {};
                const gdd = data.gdd || {};
                const chill = data.chill || {};

                // ì‹¤ì‹œê°„
                document.getElementById('temp-out').textContent = fmtTemp(pick(now['ì™¸ë¶€ì˜¨ë„'], now['ì™¸ë¶€_c']));
                document.getElementById('temp-2dong').textContent = fmtTemp(now['2ë™_c']);
                document.getElementById('temp-3dong').textContent = fmtTemp(now['3ë™_c']);

                // GDD
                const gddTotal = pick(gdd.total, gdd.cum_from_0215, gdd['ëˆ„ì _gdd_0215']);
                document.getElementById('gdd-total').textContent = gddTotal ?? '-';
                document.getElementById('gdd-total2').textContent = gddTotal ?? '-';
                document.getElementById('gdd-bud').textContent = pick(gdd.target_bud, gdd.H_BUD, '-') ;
                document.getElementById('gdd-bloom').textContent = pick(gdd.target_bloom, gdd.H_BLOOM, '-') ;

                const progress = pick(gdd.progress, '-');
                document.getElementById('gdd-progress').textContent = progress;
                document.getElementById('gdd-basis').textContent = pick(gdd.basis, '-');

                // ì˜ˆìƒì¼
                document.getElementById('bud-date').textContent = pick(gdd.bud_date, gdd.pred_bud10_date, '-');
                document.getElementById('bloom-date').textContent = pick(gdd.bloom_date, gdd.pred_bloom50_date, '-');
                document.getElementById('chill-progress').textContent = pick(chill.progress, chill.pct !== undefined ? `${chill.pct}%` : undefined, '-');

                // ì¹ ë§
                document.getElementById('chill-total').textContent = pick(chill.total_days, chill.cum, '-');

                // ì‹œê°„
                const tsRaw = pick(data.timestamp, data.updated_utc, now.timestamp);
                const ts = tsRaw ? new Date(tsRaw) : null;
                document.getElementById('timestamp').textContent = (ts && !Number.isNaN(ts.getTime()))
                    ? ts.toLocaleString('ko-KR')
                    : (tsRaw || '-');

                // ì§„í–‰ë„ ë°”
                document.querySelector('.gdd').style.setProperty('--progress', String(progress || '0%'));
            })
            .catch(() => {
                document.getElementById('timestamp').textContent = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
            });
    </script>
</body>
</html>
